# dnsmasq configuration template for PXE server
# roles/dnsmasq_pxe/templates/dnsmasq.conf.j2

# DHCP Configuration
dhcp-range={{ pxe_dhcp_range_start }},{{ pxe_dhcp_range_end }},255.255.255.0,12h
dhcp-option=option:router,{{ pxe_server_ip }}
dhcp-option=option:dns-server,{{ pxe_server_ip }}

# TFTP Configuration (PXE boot files)
tftp-root={{ tftp_root }}
enable-tftp
tftp-no-blocksize

# BOOTP/PXE boot options
dhcp-boot=tag:bios,ipxe.lkrn,{{ ansible_default_ipv4.address }}
dhcp-boot=tag:efi32,ipxe.efi,{{ ansible_default_ipv4.address }}
dhcp-boot=tag:efi64,ipxe.efi,{{ ansible_default_ipv4.address }}

# DHCP tags
dhcp-match=set:bios,option:client-arch,0
dhcp-match=set:efi32,option:client-arch,6
dhcp-match=set:efi64,option:client-arch,7
dhcp-match=set:efi64,option:client-arch,9

# DNS Configuration (local domain)
domain=supervisor.local
address=/supervisor.local/{{ ansible_default_ipv4.address | default('127.0.0.1') }}
no-resolv
server=8.8.8.8
server=8.8.4.4

# Logging
log-queries
log-facility=/var/log/dnsmasq.log

# Performance tuning
cache-size=1024
neg-ttl=3600
